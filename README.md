# InDesign グリッド分割スクリプト 仕様書

**バージョン:** 1.0 (2025年6月10日時点)  
**スクリプト名 (仮):** GridDividerID.jsx

---

## 1. 概要

本スクリプトは、Adobe InDesign上で選択した単一のオブジェクトを、指定した行数・列数および間隔でグリッド状に分割するためのExtendScriptです。Adobe Illustratorの「オブジェクト > パス > グリッドに分割」機能のInDesign版を目標とします。

### 1.1. 目的
- DTP作業における定型的なレイアウト作成を効率化する。
- 正確なサイズと間隔でのオブジェクトの分割・配置を手動で行う手間を削減する。

---

## 2. 動作環境
- **対応アプリケーション:** Adobe InDesign CC 2020 以降
- **対応OS:** macOS / Windows

---

## 3. 機能要件

### 3.1. 基本的な動作フロー
1.  ユーザーがInDesignドキュメント上で、分割したい**単一の「空の」四角形オブジェクト**を選択します。
2.  スクリプトを実行すると、設定用のダイアログUIが表示されます。
3.  ユーザーはUI上で、行と列の分割数および間隔（ミリメートル単位）を入力します。
4.  入力値に応じて、分割後の1枠あたりのサイズがUI上にリアルタイムで表示されます。
5.  ユーザーが「OK」ボタンを押すと、元のオブジェクトは削除され、計算されたサイズ・位置に新しいオブジェクト群がグリッド状に生成されます。
6.  処理全体は単一のアクションとして記録され、1回の「取り消し（Undo）」操作で処理前の状態に戻すことができます。

### 3.2. 対象オブジェクトと検証
- **対象:** `Rectangle`（四角形）オブジェクトのみを対象とします。
    - テキストフレーム、楕円形、多角形、グループ、線などは対象外とし、選択した場合は警告メッセージを表示します。
- **「空」の条件:** 以下の条件をすべて満たすオブジェクトを「空」と定義します。
    - 内部にグラフィックコンテンツ（配置された画像など）がないこと。
    - 「塗り」が「なし」であること。
    - 「線」が「なし」であること（線幅が0または線色が「なし」）。
- 上記の条件を満たさないオブジェクトを選択して実行した場合、処理を行わずに警告メッセージを表示します。

### 3.3. ダイアログUIの仕様
- **構成:**
    - **行設定パネル:**
        - 段数（行数）入力フィールド
        - 高さ（1枠あたり）表示フィールド (読み取り専用, mm単位)
        - 間隔（行間）入力フィールド (mm単位)
        - 合計（オブジェクト全体の高さ）表示フィールド (読み取り専用, mm単位)
    - **列設定パネル:**
        - 段数（列数）入力フィールド
        - 幅（1枠あたり）表示フィールド (読み取り専用, mm単位)
        - 間隔（列間）入力フィールド (mm単位)
        - 合計（オブジェクト全体の幅）表示フィールド (読み取り専用, mm単位)
- **入力値バリデーション:**
    - 段数は1以上の整数のみ受け付けます。
    - 間隔は0以上の数値のみ受け付けます。
    - 計算の結果、1枠あたりのサイズが0またはマイナスになるような不正な値の場合は、OKボタン押下時に警告を表示します。

### 3.4. 生成されるオブジェクトの仕様
- **種類:** 元のオブジェクトの種類に関わらず、`Rectangle`オブジェクトが生成されます。
- **属性:**
    - **線・塗り:** 線なし、塗なしで作成されます。
    - **レイヤー:** 元のオブジェクトと同じレイヤーに作成されます。
    - **コンテンツタイプ:** 元のオブジェクトがグラフィックフレーム (`ContentType.GRAPHIC_TYPE`) の場合、新しく作成されるフレームもグラフィックフレームの属性を維持します。
- **座標・サイズ:** UIで計算・表示された通りの正確なサイズと位置で配置されます。

---

## 4. 今後の仕様追加案

以下の機能を追加仕様として検討します。

### 4.1. ガイドライン配置機能
- **機能:** 分割した各オブジェクトの辺（X座標・Y座標）に沿ってガイドラインを配置する。
- **UI:** ダイアログに「ガイドを作成」チェックボックスを追加し、機能のON/OFFを切り替えられるようにする。
- **仕様:**
    - ガイドラインは、分割されたオブジェクトと同じレイヤーに作成する。
    - 各オブジェクトの外側の辺全てにガイドを引く。

### 4.2. テキストボックス変換機能
- **機能:** 分割して作成されるオブジェクトを、テキストボックス (`TextFrame`) に変換する。
- **UI:** ダイアログに「テキストフレームとして作成」チェックボックスを追加する。
- **仕様:**
    - このチェックボックスがONの場合、分割後のオブジェクトは全て`TextFrame`として作成される。
    - `TextFrame`のプロパティ（テキストインセット等）はInDesignのデフォルト値に従う。

### 4.3. 分割数の限界値設定
- **機能:** スクリプトがエラーにならない、または実用的でないほどの過度な分割数を制限する。
- **仕様:**
    - 行数・列数に上限値（例: 各1000）を設定する。
    - ユーザーが上限を超える値を入力した場合、警告を表示し入力を制限する。

---

## 5. 技術仕様
- **使用言語:** ExtendScript (JavaScript / ECMAScript 3準拠)
- **単位の扱い:**
    - スクリプト内部での計算・設定は、すべて**ポイント (pt)** 単位で行います。
    - ユーザーインターフェースでの表示・入力は**ミリメートル (mm)** 単位で行い、内部でポイントに変換します。
    - ドキュメントのルーラー設定に依存しない安定した動作を実現するため、座標・サイズ取得および設定時には、スクリプト側で単位を明示的に扱います。

---
